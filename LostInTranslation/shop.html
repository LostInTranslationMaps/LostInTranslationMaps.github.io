<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VVZK9H0J0T"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'G-VVZK9H0J0T');
  </script>
  <link rel="icon" type="image/png" href="/imgfavicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="img/favicon/favicon.svg" />
  <link rel="shortcut icon" href="img/favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Lost In Translation" />
  <link rel="manifest" href="/site.webmanifest" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lost In Translation™ — Shop</title>
  <link rel="stylesheet" href="css/shop.css">
</head>

<body>

  <header>
    <div class="nav">
      <a class="brand" href="#">
        <link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
        <img class="logo" src="img/Logo/flavicon.png" alt="Lost In Translation logo">
        <div>
          <div style="font-weight:800; letter-spacing:.2px;">Lost In Translation™</div>
          <div class="tag">Global Transit, Local Nonsense</div>
        </div>
      </a>
      <div class="tag"><b>You asked for it.</b> We did it. (<i>sorry</i>)</div>
    </div>
  </header>

  <main>
    <!-- LEFT: Creator + Best sellers -->
    <section class="card creator" aria-labelledby="create-title">
      <div>
        <h2 id="create-title" class="section-title">Create your own poster!</h2>
        <p class="sub">Pick a city, pick a language, and pick one of our highly unqualified AI-travel assistants to
          "help" you navigate. A map so wrong, it feels just right.</p>

        <form class="form" id="creatorForm" onsubmit="event.preventDefault(); addCreatorToCart();">
          <div class="row">
            <div>
              <label for="city">City</label>
              <input id="city" required type="text" placeholder="e.g., Amsterdam, Paris, NYC" />
            </div>
            <div>
              <label for="language">Language</label>
              <select id="language" required>
                <option value="EN">English</option>
                <option value="NL">Dutch</option>
                <option value="FR">French</option>
                <option value="DE">German</option>
                <option value="SV">Swedish</option>
              </select>
            </div>
          </div>

          <div>
            <label>AI-Travel Assistant</label>
            <div class="chips" role="group" aria-label="Persona">
              <button type="button" class="chip" data-persona="Karen" aria-pressed="true">🇬🇧 Karen</button>
              <button type="button" class="chip" data-persona="Gerrit" aria-pressed="false">🇳🇱 Gerrit</button>
              <button type="button" class="chip" data-persona="Clémence" aria-pressed="false">🇫🇷 Clémence</button>
              <button type="button" class="chip" data-persona="Dieter" aria-pressed="false">🇩🇪 Dieter</button>
              <button type="button" class="chip" data-persona="Agnes" aria-pressed="false">🇸🇪 Agnes</button>
            </div>
          </div>

          <div>
            <label>Customization</label>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; align-items:start;">

              <div>
                <span style="font-size:13px; color:#444;">Assistant's signature</span><br>
                <label><input type="radio" name="signature" value="on" checked> On</label>
                <label><input type="radio" name="signature" value="off"> Off</label>
              </div>

              <div>
                <span style="font-size:13px; color:#444;">Light / Dark</span><br>
                <label><input type="radio" name="theme" value="light" checked> Light</label>
                <label><input type="radio" name="theme" value="dark"> Dark</label>
              </div>

              <div>
                <span style="font-size:13px; color:#444;">Map legend</span><br>
                <label><input type="radio" name="legend" value="on" checked> On</label>
                <label><input type="radio" name="legend" value="off"> Off</label>
              </div>

              <div>
                <span style="font-size:13px; color:#444;">Colored lines / B&amp;W</span><br>
                <label><input type="radio" name="colorlines" value="color" checked> Colored</label>
                <label><input type="radio" name="colorlines" value="bw"> Black &amp; White</label>
              </div>

            </div>
          </div>

          <div class="row">
            <div>
              <label for="size">Size</label>
              <select id="size">
                <option value="PDF" data-upcharge="0">PDF—printable +€0</option>
                <option value="A3" data-upcharge="0">A3 (29.7×42 cm) — +€0</option>
                <option value="50x70" data-upcharge="8">50×70 cm — +€8</option>
                <option value="61x91" data-upcharge="12">61×91 cm — +€12</option>
              </select>
            </div>
            <div>
              <label for="frame">Frame</label>
              <select id="frame">
                <option value="none" data-upcharge="0">No frame — +€0</option>
                <option value="black" data-upcharge="18">Black wood — +€18</option>
                <option value="white" data-upcharge="18">White wood — +€18</option>
                <option value="oak" data-upcharge="24">Oak — +€24</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="qty">Quantity</label>
              <select id="qty">
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
              </select>
            </div>
            <div>
              <label>&nbsp;</label>
              <div class="price-line">
                <div>
                  <div class="muted">Starting at €28</div>
                  <div class="muted" id="est">Est. ship: 3–5 business days</div>
                </div>
                <div class="total" id="creatorTotal">€28</div>
              </div>
            </div>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap">
            <button class="btn btn-primary" type="submit">Add to cart</button>
            <button class="btn btn-ghost" type="button" onclick="randomizePreview()" aria-label="Regenerate preview">
              Make Dieter Work Harder
            </button>
          </div>
        </form>
      </div>

      <!-- Live preview (placeholder SVG) -->
      <div>
        <div class="preview" aria-label="Poster preview">
          <div class="badge" id="badge">🇳🇱Amsterdam · 🇺🇸 ( Karen</div>
          <img src="img/Map/amsterdam.jpg" width="100%" alt="Preview placeholder">
        </div>
        <div class="caption" style="margin-top:8px">Real preview will render your city in your language translated by
          one of our questionable AI-persona's.</div>
      </div>
    </section>

    <section class="card product" aria-labelledby="best-title">
      <h3 id="best-title" class="section-title" style="padding:12px 12px 0">🚄The <i>Tr<span
            style="font-weight: 300; margin: 1px;">ai</span>nwreck</i>-Collection</h3>
      <div class="grid" id="bestGrid" style="padding:0 12px 12px"></div>
    </section>

    <!-- RIGHT: Cart -->
    <aside class="card cart" aria-labelledby="cart-title">
      <h3 id="cart-title">Your cart</h3>
      <div class="cart-items" id="cartItems" aria-live="polite"></div>
      <div class="totals">
        <div class="row-flex"><span>Subtotal</span><strong id="subtotal">€0</strong></div>
        <div class="row-flex muted"><span>Shipping</span><span>Calculated at checkout</span></div>
        <div class="row-flex" style="margin-top:6px; font-size:18px"><span>Total</span><strong id="grand">€0</strong>
        </div>
      </div>
      <button class="btn btn-primary" style="margin-top:12px; width:100%" onclick="checkout()">Checkout</button>
      <div class="caption" style="margin-top:8px">Secure payments • 3–5 biz days • Printed in NL 🇳🇱</div>
    </aside>

    <section class="card product" aria-labelledby="karen-collection">
      <h3 id="karen-collection" class="section-title" style="padding:12px 12px 0">👩🏼Karen's <i><span
            style="font-weight: 300; margin: 1px;">Confusing Commute</span></i>-Collection</h3>
      <div class="karenGrid" id="karenGrid" style="padding:0 12px 12px"></div>
    </section>
  </main>

  <footer>
    © <b> <span id="year"></span> Lost In Translation™</b> — The Smartest Dumb Gift You'll Ever Buy
  </footer>

  <script>
    // --- Utilities
    const fmtEUR = (n) => `€${n.toFixed(0)}`;
    const round = (n) => Math.round((n + Number.EPSILON) * 100) / 100;

    // --- State
    const BASE_PRICE = 28;
    const cart = [];

    // --- Persona chips
    document.querySelectorAll('.chip').forEach(chip => {
      chip.addEventListener('click', () => {
        document.querySelectorAll('.chip').forEach(c => c.setAttribute('aria-pressed', 'false'));
        chip.setAttribute('aria-pressed', 'true');
        updateBadge();
        randomizePreview(0); // subtle refresh
        calcCreatorPrice();
      });
    });

    // --- Preview badge & form fields
    const cityEl = document.getElementById('city');
    const langEl = document.getElementById('language');
    const sizeEl = document.getElementById('size');
    const frameEl = document.getElementById('frame');
    const qtyEl = document.getElementById('qty');
    const totalEl = document.getElementById('creatorTotal');
    const badgeEl = document.getElementById('badge');

    [cityEl, langEl, sizeEl, frameEl, qtyEl].forEach(el => el.addEventListener('input', () => {
      updateBadge();
      calcCreatorPrice();
    }));

    function currentPersona() {
      const p = [...document.querySelectorAll('.chip')].find(c => c.getAttribute('aria-pressed') === 'true');
      return p ? p.dataset.persona : 'Karen';
    }

    function updateBadge() {
      const city = cityEl.value || 'Amsterdam';
      const langNameFull = ({
        EN: '🇬🇧English',
        NL: '🇳🇱Dutch',
        FR: '🇫🇷French',
        DE: '🇩🇪German',
        SV: '🇸🇪Swedish'
      })[langEl.value] || 'English';
      badgeEl.textContent = `${city} · ${langNameFull} by ${currentPersona()}`;
    }

    function calcCreatorPrice() {
      const sizeUp = Number(sizeEl.selectedOptions[0].dataset.upcharge || 0);
      const frameUp = Number(frameEl.selectedOptions[0].dataset.upcharge || 0);
      const qty = Number(qtyEl.value || 1);
      const unit = BASE_PRICE + sizeUp + frameUp;
      totalEl.textContent = fmtEUR(unit * qty);
      return {
        unit,
        qty,
        total: unit * qty
      };
    }

    // --- Simple “randomize preview” (just jogs line coordinates)
    function randomizePreview(jitter = 10) {
      const l1 = document.getElementById('L1');
      const l2 = document.getElementById('L2');
      const l3 = document.getElementById('L3');
      [l1, l2, l3].forEach(poly => {
        if (!poly) return;
        const pts = poly.getAttribute('points').trim().split(' ').map(pair => {
          let [x, y] = pair.split(',').map(Number);
          x += (Math.random() - .5) * jitter;
          y += (Math.random() - .5) * jitter;
          return `${Math.max(20, Math.min(780, x)).toFixed(0)},${Math.max(120, Math.min(960, y)).toFixed(0)}`;
        });
        poly.setAttribute('points', pts.join(' '));
      });
    }

    // --- Add from creator
    function addCreatorToCart() {
      const {
        unit,
        qty,
        total
      } = calcCreatorPrice();
      const item = {
        id: crypto.randomUUID(),
        type: 'custom',
        city: cityEl.value || 'Amsterdam',
        language: langEl.value,
        persona: currentPersona(),
        size: sizeEl.value,
        frame: frameEl.value,
        qty,
        unit,
        total
      };
      cart.push(item);
      renderCart();
      alert('Added to cart!');
    }

    // --- Best sellers (general)
    const best = [{
        city: '🇳🇱Amsterdam',
        language: '🇺🇸English',
        persona: 'Karen',
        price: 28,
        sku: 'PAR-EN-CLE'
      },
      {
        city: '🇩🇪Berlin',
        language: '🇫🇷Français',
        persona: 'Clémence',
        price: 36,
        sku: 'BER-NL-DIE'
      },
      {
        city: '🇸🇪Stockholm',
        language: '🇳🇱Nederlands',
        persona: 'Gerrit',
        price: 28,
        sku: 'STO-NL-AGN'
      },
      {
        city: '🇺🇸New York',
        language: '🇳🇱Nederlands',
        persona: 'Gerrit',
        price: 40,
        sku: 'NYC-NL-GER'
      },
      {
        city: '🇫🇷Paris',
        language: '🇸🇪Svenska',
        persona: 'Agnes',
        price: 28,
        sku: 'AMS-FR-KAR'
      },
      {
        city: '🇬🇧London',
        language: '🇩🇪Deutsch',
        persona: 'Dieter',
        price: 36,
        sku: 'LON-DE-DIE'
      },
    ];

    // --- Best sellers (Karen collection)
    const bestKaren = [{
        city: '🇩🇪Berlin',
        language: '🇺🇸English',
        persona: 'Karen',
        price: 36,
        sku: 'BER-NL-DIE'
      },
      {
        city: '🇸🇪Stockholm',
        language: '🇺🇸English',
        persona: 'Karen',
        price: 28,
        sku: 'STO-NL-AGN'
      },
      {
        city: '🇫🇷Paris',
        language: '🇺🇸English',
        persona: 'Karen',
        price: 28,
        sku: 'AMS-FR-KAR'
      }
    ];

    function productThumbSVG(title) {
      // Tiny inline placeholder that links to an example map
      return `
        <a href="Maps/Amsterdam/amsterdam.html" aria-label="${title}">
          <img src="img/Map/amsterdam.jpg" width="100%" alt="${title}">
        </a>
      `;
    }

    function langName(code) {
      // If a flag + language label is already provided, just return it.
      const map = {
        EN: 'English',
        NL: 'Dutch',
        FR: 'French',
        DE: 'German',
        SV: 'Swedish'
      };
      return map[code] || code;
    }

    function renderBest() {
      const grid = document.getElementById('bestGrid');
      grid.innerHTML = '';
      best.forEach(p => {
        const el = document.createElement('div');
        el.className = 'card product';
        el.innerHTML = `
          <div class="thumb">${productThumbSVG(`${p.city} ${p.language}`)}</div>
          <div class="title">${p.city} · ${langName(p.language)} by ${p.persona}</div>
          <div class="caption">Gorgeously Wrong. Instantly Yours.</div>
          <div style="display:flex; align-items:center; justify-content:space-between; margin-top:8px">
            <div class="price">${fmtEUR(p.price)}</div>
            <button class="btn btn-primary" aria-label="Add ${p.city} poster to cart">Add</button>
          </div>
        `;
        el.querySelector('button').addEventListener('click', () => {
          cart.push({
            id: crypto.randomUUID(),
            type: 'preset',
            city: p.city,
            language: p.language,
            persona: p.persona,
            size: 'A3',
            frame: 'none',
            qty: 1,
            unit: p.price,
            total: p.price
          });
          renderCart();
        });
        grid.appendChild(el);
      });
    }

    function renderKaren() {
      const grid = document.getElementById('karenGrid');
      grid.innerHTML = '';
      // IMPORTANT FIX: iterate over bestKaren (not best)
      bestKaren.forEach(p => {
        const el = document.createElement('div');
        el.className = 'card product';
        el.innerHTML = `
          <div class="thumb">${productThumbSVG(`${p.city} ${p.language}`)}</div>
          <div class="title">${p.city} · ${langName(p.language)} by ${p.persona}</div>
          <div class="caption">Karen was here! Redesigned for your convenience (and hers).</div>
          <div style="display:flex; align-items:center; justify-content:space-between; margin-top:8px">
            <div class="price">${fmtEUR(p.price)}</div>
            <button class="btn btn-primary" aria-label="Add ${p.city} poster to cart">Add</button>
          </div>
        `;
        el.querySelector('button').addEventListener('click', () => {
          cart.push({
            id: crypto.randomUUID(),
            type: 'preset',
            city: p.city,
            language: p.language,
            persona: p.persona,
            size: 'A3',
            frame: 'none',
            qty: 1,
            unit: p.price,
            total: p.price
          });
          renderCart();
        });
        grid.appendChild(el);
      });
    }

    // --- Cart rendering
    function renderCart() {
      const wrap = document.getElementById('cartItems');
      wrap.innerHTML = '';
      if (cart.length === 0) {
        wrap.innerHTML =
          `<div class="caption">Your cart is empty. Start your journey to questionable taste today!</div>`;
      }
      let subtotal = 0;
      cart.forEach(item => {
        subtotal += item.total;
        const line = document.createElement('div');
        line.className = 'line';
        const thumb = document.createElement('div');
        thumb.className = 'thumb-xs';
        thumb.innerHTML = productThumbSVG(`${item.city} ${item.language}`);
        const info = document.createElement('div');
        const title = `${item.city} · ${langName(item.language)} · ${item.persona}`;
        info.innerHTML = `
          <div style="font-weight:600">${title}</div>
          <div class="caption">Size: ${item.size} · Frame: ${item.frame} · Qty: ${item.qty}</div>
          <button class="remove" aria-label="Remove item">Remove</button>
        `;
        const price = document.createElement('div');
        price.style.fontWeight = '700';
        price.textContent = fmtEUR(item.total);

        info.querySelector('.remove').addEventListener('click', () => {
          const idx = cart.findIndex(c => c.id === item.id);
          if (idx > -1) {
            cart.splice(idx, 1);
            renderCart();
          }
        });

        line.appendChild(thumb);
        line.appendChild(info);
        line.appendChild(price);
        wrap.appendChild(line);
      });
      document.getElementById('subtotal').textContent = fmtEUR(subtotal);
      document.getElementById('grand').textContent = fmtEUR(subtotal);
    }

    // --- Fake checkout
    function checkout() {
      if (cart.length === 0) {
        alert('Your cart is empty.');
        return;
      }
      alert('Proceeding to checkout… (wire to your provider)');
    }

    // Init
    document.getElementById('year').textContent = new Date().getFullYear();
    renderBest(); // Populate general best-sellers grid
    renderKaren(); // IMPORTANT: Populate Karen collection grid
    updateBadge(); // Set initial badge text
    calcCreatorPrice(); // Compute initial price
  </script>
</body>

</html>